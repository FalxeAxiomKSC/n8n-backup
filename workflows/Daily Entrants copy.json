{"updatedAt":"2026-02-06T21:50:23.815Z","createdAt":"2026-02-06T21:50:23.815Z","id":"n7uv54FsKN6pUjFy","name":"Daily Entrants copy","active":false,"isArchived":false,"nodes":[{"parameters":{"operation":"formatDate","date":"={{ $json.newDate }}","format":"X","outputFieldName":"currentDateUnix","options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-4320,800],"id":"db8cb71c-af37-432e-847d-839b27f5f315","name":"Date & Time1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-4864,880],"id":"6003fe80-3e68-45fd-907d-a8ef6112f4f8","name":"Date & Time"},{"parameters":{"operation":"subtractFromDate","magnitude":"={{ $json.roundedDate }}","duration":1,"outputFieldName":"dayAgo","options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-4480,960],"id":"f5a2f003-172f-4111-b4d6-c6e8df081ffa","name":"Date & Time2"},{"parameters":{"operation":"formatDate","date":"={{ $json.dayAgo }}","format":"X","outputFieldName":"dayAgoUnix","options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-4320,960],"id":"7c0a135b-a7b0-4107-aac5-610a75e6239d","name":"Date & Time3"},{"parameters":{"mode":"combine","combineBy":"combineAll","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-4144,880],"id":"d1c55fbf-cf36-452d-9357-4ab0930a4e24","name":"Merge"},{"parameters":{"fieldToSplitOut":"data.data.tournaments.nodes","include":"selectedOtherFields","fieldsToInclude":"={{ $json.data.data.tournaments.nodes[0].name }} {{ $json.data.data.tournaments.nodes[0].events }}","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-3776,880],"id":"ca6c73e5-e4f3-4a25-b1a5-535953356496","name":"Split Out"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b84a0c12-449a-4756-aeeb-017a0f934e38","leftValue":"={{ $json['data.data.tournaments.nodes'].events[0].numEntrants }}","rightValue":0,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-3136,768],"id":"1e7a01f4-c808-4edf-aa63-4082f019cace","name":"Filter1"},{"parameters":{"fieldsToSummarize":{"values":[{"aggregation":"sum","field":"['data.data.tournaments.nodes'].events[0].numEntrants"},{"aggregation":"sum","field":"['data.data.tournaments.nodes'].events[1].numEntrants"}]},"options":{}},"type":"n8n-nodes-base.summarize","typeVersion":1.1,"position":[-2720,640],"id":"a2512b3c-96ae-4be3-ad0d-17cafcd025be","name":"Summarize"},{"parameters":{"maxItems":5},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[-2480,912],"id":"de994fc0-cc41-47c8-a589-87bace5a0c3d","name":"Limit"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[160,0],"id":"b72b2c47-6dbd-4feb-971a-cad496145666","name":"Aggregate"},{"parameters":{"mode":"combine","combineBy":"combineAll","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[0,0],"id":"92f753dd-cfe5-4b3d-9851-daeadbcc9a6a","name":"Merge1"},{"parameters":{"rule":{"interval":[{"triggerAtHour":17,"triggerAtMinute":21}]}},"id":"093896a3-c87c-4f5f-a2a5-47972696c503","name":"Run Daily @ 4:21pm","type":"n8n-nodes-base.scheduleTrigger","position":[-5024,880],"typeVersion":1.2},{"parameters":{"authentication":"headerAuth","endpoint":"https://api.start.gg/gql/alpha","query":"=query Tournaments($gameId: [ID]!, $startDate: Timestamp!, $endDate: Timestamp!, $eventType: [Int]!) { tournaments(query: { perPage: 500, filter: { videogameIds: $gameId, afterDate: $startDate, beforeDate: $endDate } }) { nodes { name addrState countryCode events(filter: { videogameId: $gameId, type: $eventType })  { id tournament { name } name slug numEntrants } } } }","variables":"={ \"gameId\": [53945], \"startDate\": {{ $json.dayAgoUnix }}, \"endDate\": {{ $json.currentDateUnix }}, \"eventType\": [1]  }","responseFormat":"string","headerParametersUi":{"parameter":[{"name":"Authorization","value":"={{$env.STARTGG_TOKEN}}"}]}},"type":"n8n-nodes-base.graphql","typeVersion":1.1,"position":[-3968,880],"id":"36e367af-3a92-4f31-b772-1b6c8d0d5336","name":"GraphQL Events","credentials":{"httpHeaderAuth":{"id":"OHPOzv5xBBYipCbV","name":"Header Auth account"}}},{"parameters":{"authentication":"headerAuth","endpoint":"https://api.start.gg/gql/alpha","query":"=query Event($eventId: ID!) { event(id: $eventId) { id phases { id } phaseGroups { id phase { phaseOrder id name } } tournament { name } } }","variables":"={ \"eventId\": {{ $json['[\\'data.data.tournaments.nodes\\'].events'].id }}}","responseFormat":"string","headerParametersUi":{"parameter":[{"name":"Authorization","value":"={{$env.STARTGG_TOKEN}}"}]}},"type":"n8n-nodes-base.graphql","typeVersion":1.1,"position":[-2320,912],"id":"2adadc7e-c393-4834-9afa-ce22be39d0e0","name":"GraphQL Phases","credentials":{"httpHeaderAuth":{"id":"OHPOzv5xBBYipCbV","name":"Header Auth account"}}},{"parameters":{"fieldToSplitOut":"data.data.event.phaseGroups","include":"selectedOtherFields","fieldsToInclude":"data.data.event.tournament.name, data.data.event.id","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-2160,912],"id":"4718c881-9a2a-46bb-ad0e-03e1b9067323","name":"Split Out1"},{"parameters":{"sortFieldsUi":{"sortField":[{"fieldName":"=['data.data.event.phaseGroups'].phase.phaseOrder","order":"descending"}]},"options":{}},"type":"n8n-nodes-base.sort","typeVersion":1,"position":[-1984,912],"id":"db5ce27b-93e5-4309-8708-422ec7b7aeb6","name":"Sort1"},{"parameters":{"fieldToSplitOut":"data.data.phase.sets.nodes[0].games","include":"selectedOtherFields","fieldsToInclude":"data.data.phase.sets.nodes[0].displayScore, data.data.phase.sets.nodes[0].games[0].selections[0].character.name, data.data.phase.sets.nodes[0].games[0].selections[1].character.name, data.data.phase.sets.nodes[0].id, data.data.phase.sets.nodes[0].winnerId, data.data.phase.event.id, data.data.phase.event.tournament.name","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-2320,1104],"id":"46d64209-d03c-4d12-91ea-c093c27c3c3e","name":"Split Out2"},{"parameters":{"sortFieldsUi":{"sortField":[{"fieldName":"['data.data.phase.sets.nodes[0].games'].orderNum","order":"descending"}]},"options":{}},"type":"n8n-nodes-base.sort","typeVersion":1,"position":[-2160,1104],"id":"a72560b0-993a-4cc3-97bf-72a29799d021","name":"Sort2"},{"parameters":{"authentication":"headerAuth","endpoint":"https://api.start.gg/gql/alpha","query":"=query PhaseInfo($phaseId: ID!) { phase(id: $phaseId) { id name phaseOrder phaseGroups { nodes { id bracketType } } sets { nodes { id displayScore identifier round games { orderNum } winnerId } } event { id tournament { name } } } }","variables":"={ \"phaseId\": {{ $json['data.data.event.phaseGroups'].phase.id }} }","responseFormat":"string","headerParametersUi":{"parameter":[{"name":"Authorization","value":"={{$env.STARTGG_TOKEN}}"}]}},"type":"n8n-nodes-base.graphql","typeVersion":1.1,"position":[-2480,1104],"id":"f9f0bbe1-42bf-4bbf-96de-54d6499c0a65","name":"GraphQL Phases1","credentials":{"httpHeaderAuth":{"id":"OHPOzv5xBBYipCbV","name":"Header Auth account"}}},{"parameters":{"authentication":"headerAuth","endpoint":"https://api.start.gg/gql/alpha","query":"=query GetEntrant($entrantId: ID!) { entrant(id: $entrantId) { id name } }","variables":"={{ $json[\"data.data.phase.sets.nodes[0].winnerId\"] !== null ? JSON.stringify({ \"entrantId\": $json[\"data.data.phase.sets.nodes[0].winnerId\"] }) : \"{}\" }}\n","responseFormat":"string","headerParametersUi":{"parameter":[{"name":"Authorization","value":"={{$env.STARTGG_TOKEN}}"}]}},"type":"n8n-nodes-base.graphql","typeVersion":1.1,"position":[-1584,1200],"id":"00f8dc4f-ff6e-4058-929e-00f529caeed6","name":"GraphQL Phases2","alwaysOutputData":true,"credentials":{"httpHeaderAuth":{"id":"OHPOzv5xBBYipCbV","name":"Header Auth account"}}},{"parameters":{"assignments":{"assignments":[{"id":"08f7949b-ccdd-4ce2-90be-247b219e0644","name":"['data.data.phase.sets.nodes[0].winnerId']","value":"={{ $json.data.data.entrant.id }}","type":"number"},{"id":"77c4edc8-74bf-455d-a44c-dd2bc177f0c3","name":"winnerName","value":"={{ $json.data.data.entrant.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1408,1200],"id":"d6830a48-cefa-4f81-a26b-bbd5f7963054","name":"Edit Fields"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5a76826e-fe59-4295-950f-d2a947a7d07f","leftValue":"={{ $json['data.data.phase.sets.nodes[0].winnerId'] }}","rightValue":"","operator":{"type":"number","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-1776,1200],"id":"7ba17b61-422f-4c81-bbd0-7e58398c9b20","name":"Filter"},{"parameters":{"mode":"combine","advanced":true,"mergeByFields":{"values":[{"field1":"['[\\'data.data.tournaments.nodes\\'].events'].id","field2":"data.data.phase.event.id"}]},"options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-1600,624],"id":"419238c8-14bd-4636-98fa-415a059c2afd","name":"Merge Events"},{"parameters":{"mode":"combine","fieldsToMatchString":"['data.data.phase.sets.nodes[0].winnerId']","joinMode":"keepEverything","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-608,288],"id":"a2b53eaf-cc90-4738-9a49-de0c0288d6e7","name":"Merge Events and Winners"},{"parameters":{"mode":"combine","fieldsToMatchString":"['data.data.phase.sets.nodes[0].winnerId']","joinMode":"keepEverything","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-736,544],"id":"b7bb9a52-17dd-4fe9-8b89-6cb8896c7efc","name":"Merge Winners"},{"parameters":{"jsCode":"// Get input data\nconst items = $input.all();\n\n// Initialize storage for unique set IDs\nconst seenSetIds = new Set();\nconst result = [];\n\n// Iterate through sorted data\nfor (const item of items) {\n    const setId = item.json[\"data.data.phase.sets.nodes[0].id\"];\n    \n    if (!seenSetIds.has(setId)) {\n        seenSetIds.add(setId);\n        result.push(item);\n    }\n}\n\n// Return filtered results\nreturn result;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1984,1104],"id":"22e6d0bd-8642-48f8-abfa-2b39ccee488c","name":"Code Top5 Events"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b589aefc-bb1b-4b40-93d8-3080d320f853","leftValue":"={{ $json.characterCount }}","rightValue":301,"operator":{"type":"number","operation":"lt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[64,320],"id":"9e7cced4-8729-4e9c-b08c-c0a0cf8254d0","name":"If 280 > x > 300"},{"parameters":{"jsCode":"// Define max tournament name length\nconst maxLength = 40;\n\n// Define key phrases to be hashtagged, replacing spaces with no-space formatting\nconst hashtagKeywords = {\n    \"Rivals2\": \"#Rivals2\",\n    \"Rivals of Aether\": \"#RivalsOfAether\",\n    \"Melee\": \"#Melee\",\n    \"Rivals\": \"#Rivals\",\n    \"Smash\": \"#Smash\",\n    \"Ultimate\": \"#Ultimate\",\n    \"Aether\": \"#Aether\"\n};\n\n// Function to replace keywords with their hashtag versions\nconst addHashtags = (name) => {\n    let updatedName = name;\n    Object.keys(hashtagKeywords).forEach((word) => {\n        const regex = new RegExp(`\\\\b${word}\\\\b`, \"gi\");\n        updatedName = updatedName.replace(regex, hashtagKeywords[word]);\n    });\n    return updatedName;\n};\n\n// Function to truncate names while keeping key details\nconst truncateName = (name) => {\n    let truncatedName = addHashtags(name);\n    \n    if (truncatedName.length <= maxLength) {\n        return truncatedName;\n    }\n    \n    const splitCharacters = [\"-\", \"@\", \"#\", \":\", \"|\"];\n    let segments = [truncatedName];\n    \n    splitCharacters.forEach((char) => {\n        if (truncatedName.includes(char)) {\n            segments = truncatedName.split(char).map(segment => segment.trim());\n        }\n    });\n    \n    let cleanedName = segments[0];\n    for (let i = 1; i < segments.length; i++) {\n        const segment = segments[i];\n        if (Object.keys(hashtagKeywords).some(key => segment.includes(key))) {\n            cleanedName += `, ${segment}`;\n        }\n    }\n    \n    if (cleanedName.length > maxLength) {\n        cleanedName = cleanedName.substring(0, maxLength).trim();\n        if (cleanedName.includes(\" \")) {\n            cleanedName = cleanedName.substring(0, cleanedName.lastIndexOf(\" \"));\n        }\n        cleanedName += \"...\";\n    }\n    \n    return cleanedName;\n};\n\n// Define mapping of character names to icons\nconst characterIcons = {\n    \"Forsburn\": \"â˜ ï¸\",\n    \"Loxodont\": \"ðŸ˜\",\n    \"Clairen\": \"ðŸ¤º\",\n    \"Zetterburn\": \"ðŸ¦\",\n    \"Wrastor\": \"ðŸ¦…\",\n    \"Fleet\": \"ðŸ¦Š\",\n    \"Maypul\": \"ðŸŒ±\",\n    \"Kragg\": \"ðŸª²\",\n    \"Ranno\": \"ðŸ¸\",\n    \"Orcane\": \"ðŸ‹\",\n    \"Etalus\": \"ðŸ»â€\",\n    \"Olympia\": \"ðŸ’Ž\"\n};\n\n// Retrieve total entrants\nconst totalEntrants = $input.first().json.data[0].$json['sum_\\'data_data_tournaments_nodes\\'_events0_numEntrants'] || 0;\n\n// Retrieve and process tournament data\nconst tournamentData = Array.from({ length: 5 }, (_, i) => {\n    const tournamentNode = $input.first()?.json?.data?.[i]?.[\"data.data.tournaments.nodes\"] || {};\n    const eventNode = $input.first()?.json?.data?.[i]?.[\"data.data.set.event\"] || {};\n    const winnerName = $input.first()?.json?.data?.[i]?.winnerName || \"\";\n\n    // Get the tournament name\n    const baseName = eventNode.tournament?.name || tournamentNode.name || \"N/A\";\n\n    // Get location from tournament data\n    const location = tournamentNode.countryCode && tournamentNode.countryCode !== \"US\" \n        ? tournamentNode.countryCode \n        : tournamentNode.addrState || \"\";\n\n    // Append location if available\n    const nameWithLocation = location ? `${baseName} (${location})` : baseName;\n\n    // Find correct entrant count using the provided reference\n    const entrants = $input.first()?.json?.data?.[i]?.[\"['data.data.tournaments.nodes'].events\"]?.numEntrants || 0;\n\n    // Retrieve character selection from first game (if available)\n    const selections = $input.first()?.json?.data?.[i]?.[\"data.data.set.games[0].selections\"] || [];\n    let characterName = \"\";\n\n    if (Array.isArray(selections)) {\n        characterName = selections.find(selection => selection?.character?.name)?.character?.name || \"\";\n    } else if (selections.character) {\n        characterName = selections.character.name;\n    }\n\n    // Get icon for character or default \"W:\"\n    const icon = characterIcons[characterName] || \"W:\";\n\n    return {\n        originalName: nameWithLocation,\n        truncatedName: truncateName(nameWithLocation),\n        entrants,\n        winner: winnerName ? `   ${icon} ${winnerName}` : \"\"\n    };\n});\n\n// Ensure there are at least 5 tournament entries\nwhile (tournamentData.length < 5) {\n    tournamentData.push({ originalName: \"N/A\", truncatedName: \"N/A\", entrants: 0, winner: \"\" });\n}\n\n// Construct tournament list\nlet tournamentList = \"\\n\\n\";\ntournamentData.forEach((tournament) => {\n    tournamentList += `${tournament.truncatedName} - ${tournament.entrants} entrants\\n${tournament.winner}\\n`;\n});\n\n// Construct final message\nconst inputString = \"Yesterday in #Rivals2!\";\nconst finalString = `${inputString}${tournamentList}\\nEntrants yesterday: ${totalEntrants}`.trim();\n\n// Return result\nreturn [{ \n    result: finalString, \n    characterCount: finalString.length \n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[320,0],"id":"7a6c54de-1666-47ed-9a50-91491cd59ca6","name":"Assemble Post"},{"parameters":{"authentication":"headerAuth","endpoint":"https://api.start.gg/gql/alpha","query":"=query SetInfo($setId: ID!) {\n    set(id: $setId) {\n        id\n        winnerId\n        games {\n            selections {\n                character {\n                    name\n                }\n                entrant {\n                    name\n                    id\n                }\n            }\n        }\n        displayScore\n        event {\n            tournament {\n                name\n            }\n            id\n        }\n    }\n}","variables":"={{ $json[\"data.data.phase.sets.nodes[0].id\"] !== null ? JSON.stringify({ \"setId\": $json[\"data.data.phase.sets.nodes[0].id\"] }) : \"{}\" }}","responseFormat":"string","headerParametersUi":{"parameter":[{"name":"Authorization","value":"={{$env.STARTGG_TOKEN}}"}]}},"type":"n8n-nodes-base.graphql","typeVersion":1.1,"position":[-1584,1408],"id":"e0c3ad0b-f51d-4c7a-96b4-265f9cb80c6f","name":"GraphQL Phases3","alwaysOutputData":true,"credentials":{"httpHeaderAuth":{"id":"OHPOzv5xBBYipCbV","name":"Header Auth account"}}},{"parameters":{"mode":"combine","advanced":true,"mergeByFields":{"values":[{"field1":"['data.data.phase.sets.nodes[0].winnerId']","field2":"data.data.set.winnerId"}]},"joinMode":"enrichInput1","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-928,1200],"id":"b7187ab3-b652-4f6f-857a-d41c9fee55c8","name":"Merge Winners1"},{"parameters":{"fieldToSplitOut":"data.data.set.games[0].selections, data.data.set.games[1].selections, data.data.set.games[2].selections, data.data.set.games[].selections, data.data.set.games[].selections, ","include":"selectedOtherFields","fieldsToInclude":"data.data.set.event.tournament.name, data.data.set.event.id, data.data.set.winnerId, data.data.set.winnerId","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-1408,1408],"id":"7ab1b120-be1a-4603-b523-f6ad7d315ef0","name":"Split Out3"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"9352ecff-ac16-48dd-a6ff-435f91bbd70b","leftValue":"={{ $json['data.data.set.games[0].selections'].entrant.id }}","rightValue":"={{ $json['data.data.set.winnerId'] }}","operator":{"type":"number","operation":"equals"}},{"id":"17376203-2890-48f3-b6ec-8adc039f279e","leftValue":"={{ $json['data.data.set.games[1].selections'].entrant.id }}","rightValue":"={{ $json['data.data.set.winnerId'] }}","operator":{"type":"number","operation":"equals"}},{"id":"1da72bbd-51af-4303-9bde-53ef65d6c4ad","leftValue":"={{ $json['data.data.set.games[2].selections'].entrant.id }}","rightValue":"={{ $json['data.data.set.winnerId'] }}","operator":{"type":"number","operation":"equals"}},{"id":"cd2416a1-1864-4707-9060-5ed7d683a584","leftValue":"={{ $json['data.data.set.games[3].selections'].entrant.id }}","rightValue":"={{ $json['data.data.set.winnerId'] }}","operator":{"type":"number","operation":"equals"}},{"id":"cc59f5cf-2e5c-4502-b2d0-1d691e2b1271","leftValue":"={{ $json['data.data.set.games[4].selections'].entrant.id }}","rightValue":"={{ $json['data.data.set.winnerId'] }}","operator":{"type":"number","operation":"equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-1216,1408],"id":"4a3a9da7-d9a5-4fe5-92ec-b80c68672e7a","name":"Filter2"},{"parameters":{"fieldToSplitOut":"['data.data.tournaments.nodes'].events","include":"selectedOtherFields","fieldsToInclude":"={{ $json['data.data.tournaments.nodes'].name }}","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-3584,880],"id":"cd76a3b0-aa2c-4e7f-abf7-2542c69746d9","name":"Split Out4"},{"parameters":{"mode":"combine","advanced":true,"mergeByFields":{"values":[{"field1":"['data.data.tournaments.nodes'].events[0].tournament.name","field2":"['[\\'data.data.tournaments.nodes\\'].events'].tournament.name"}]},"options":{}},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-3344,768],"id":"264f48db-af45-44db-b9c0-936719772fee","name":"Merge Events1"},{"parameters":{"assignments":{"assignments":[{"id":"8396582b-b19a-48d6-8763-3bdf55723ab3","name":"=$json['sum_\\'data_data_tournaments_nodes\\'_events0_numEntrants']","value":"={{$json['sum_\\'data_data_tournaments_nodes\\'_events0_numEntrants'] + $json['sum_\\'data_data_tournaments_nodes\\'_events1_numEntrants']}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2480,640],"id":"7bec7a9c-1191-44f9-98e0-68cf49ee4971","name":"Edit Fields2"},{"parameters":{"jsCode":"// Get all input items from the previous node in n8n\nconst items = $input.all();\n\n// Initialize a Set to track unique event IDs\nconst seenEventIds = new Set();\n\n// Initialize an array to store the filtered results\nconst result = [];\n\n// Iterate through all input items (assumed to be sorted beforehand)\nfor (const item of items) {\n    \n    // Extract the event ID (used for uniqueness filtering)\n    const eventId = item.json[\"data.data.event.id\"];\n\n    // If this event ID hasn't been seen before, add it to the result list\n    if (!seenEventIds.has(eventId)) {\n        seenEventIds.add(eventId); // Mark it as seen\n        result.push(item); // Store the first occurrence of this event ID\n    }\n\n    // Stop processing once we have collected 5 unique events\n    if (result.length === 5) {\n        break;  \n    }\n}\n\n// Return the filtered results containing at most 5 unique event IDs\nreturn result;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2720,1104],"id":"19faf56a-ffb1-4f3e-8a0c-401764b5f7cd","name":"Code3"},{"parameters":{"assignments":{"assignments":[{"id":"30a8800a-7914-442c-b348-495ef081e6c8","name":"totalEntrants","value":"={{ $('Aggregate').item.json.data[0].$json['sum_\\'data_data_tournaments_nodes\\'_events0_numEntrants'] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,0],"id":"838c1d6b-bf2a-4a6b-938a-a42395590eeb","name":"Edit Fields3"},{"parameters":{"sortFieldsUi":{"sortField":[{"fieldName":"['data.data.tournaments.nodes'].events[0].numEntrants","order":"descending"}]},"options":{}},"type":"n8n-nodes-base.sort","typeVersion":1,"position":[-2720,912],"id":"556e1a57-37ff-4a9a-ac30-a20cec7022b8","name":"Sort"},{"parameters":{"content":"Need to adjust these. Not finding multiday events and only looking at last game for winning character. Grand finals reset does something weird too.","height":540,"width":2180},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2864,1040],"id":"a485a8e4-c83e-4142-8728-0b2cb3094785","name":"Sticky Note"},{"parameters":{"method":"POST","url":"https://bsky.social/xrpc/com.atproto.server.createSession","sendBody":true,"bodyParameters":{"parameters":[{"name":"identifier","value":"={{ $json.BlueskyHandle }}"},{"name":"password","value":"={{ $json.BlueskyAppPassword }}"}]},"options":{}},"id":"21e7d58b-5e84-4556-86eb-9f43f9e5c076","name":"Create Bluesky Session","type":"n8n-nodes-base.httpRequest","position":[1728,672],"typeVersion":4.2},{"parameters":{"assignments":{"assignments":[{"id":"ec07f538-0164-40c5-a199-45e2a8a4604a","name":"BlueskyHandle","type":"string","value":"rivals2statbot.bsky.social"},{"id":"463e906c-c49b-41e0-9176-04bd2c175d0b","name":"BlueskyAppPassword","type":"string","value":"#m;:vBeyRiWE83K"}]},"options":{}},"id":"5949215a-a718-4532-805b-0f8aede057b4","name":"Set Bluesky Credentials","type":"n8n-nodes-base.set","position":[1504,672],"typeVersion":3.4},{"parameters":{"method":"POST","url":"https://bsky.social/xrpc/com.atproto.repo.createRecord","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('Create Bluesky Session').item.json.accessJwt}}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $('Create Post Text').item.json.toJsonString() }}","options":{}},"id":"fa2543dd-bf40-41f2-8c55-62c89b183b55","name":"Create Initial Post","type":"n8n-nodes-base.httpRequest","position":[1728,912],"typeVersion":4.2},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Create the initial post text\nconst postText = $('Aggregate2').item.json.data[0].result;\n;\n\n// Create the parent post object\nconst postData = {\n    repo: $('Set Bluesky Credentials').first().json.BlueskyHandle,\n    collection: \"app.bsky.feed.post\",\n    record: {\n        $type: \"app.bsky.feed.post\",\n        text: postText,\n        createdAt: $now\n    }\n};\n\nreturn postData;"},"id":"ebd9b5b2-661d-4f81-b1e0-15d3358b7aae","name":"Create Post Text","type":"n8n-nodes-base.code","position":[1504,912],"typeVersion":2},{"parameters":{"method":"POST","url":"https://bsky.social/xrpc/com.atproto.repo.createRecord","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('Create Bluesky Session').item.json.accessJwt}}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $('Create Reply Text1').item.json.toJsonString() }} ","options":{}},"id":"7449b0a5-ab76-4374-9769-6612bfcd1646","name":"Create Reply1","type":"n8n-nodes-base.httpRequest","position":[1728,1152],"typeVersion":4.2},{"parameters":{"jsCode":"// Create the reply text\nconst replyText = $('Aggregate2').first().json.data[1].result;\n\n// Calculate timestamp 1 second from now\nconst futureDate = new Date(Date.now() + 1000);\n\n// Create the reply post object\nconst replyPostData = {\n    repo: $('Set Bluesky Credentials').first().json.BlueskyHandle,\n    collection: \"app.bsky.feed.post\",\n    record: {\n        \"$type\": \"app.bsky.feed.post\",\n        text: replyText,\n        reply: {\n            root: {\n                cid: $('Create Initial Post').first().json.cid,\n                uri: $('Create Initial Post').first().json.uri\n            },\n            parent: {\n                cid: $('Create Initial Post').first().json.cid,\n                uri: $('Create Initial Post').first().json.uri\n            }\n        },\n        createdAt: futureDate.toISOString()\n    }\n};\n\nreturn replyPostData;"},"id":"b8627cb4-1ffb-44a5-88f3-b50d8eeac1d6","name":"Create Reply Text1","type":"n8n-nodes-base.code","position":[1504,1152],"typeVersion":2},{"parameters":{"maxItems":3},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[688,560],"id":"5107640a-ca7f-4bda-bd08-f7e9c6860f3c","name":"Limit1"},{"parameters":{"maxItems":2,"keep":"lastItems"},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[688,800],"id":"99338c5c-e141-4175-a6e2-1cde84e9d116","name":"Limit2"},{"parameters":{"jsCode":"// Define key phrases that should be kept and hashtagged\nconst hashtagKeywords = {\n};\n\n// Function to apply hashtags to specific keywords\nconst addHashtags = (name) => {\n    let updatedName = name;\n    Object.keys(hashtagKeywords).forEach((word) => {\n        const regex = new RegExp(`(?<!\\\\w)${word}(?!\\\\w)`, \"gi\");\n        updatedName = updatedName.replace(regex, hashtagKeywords[word]);\n    });\n    return updatedName;\n};\n\n// Retrieve input string\nconst inputString = \"Yesterday in #Rivals2!\";\n\n// Get tournament data from previous node\nconst tournaments = $input.all();\n\n// Ensure valid input\nif (!Array.isArray(tournaments) || tournaments.length === 0) {\n    return [{ result: \"Error: No tournament data received.\", characterCount: 0 }];\n}\n\n// Format the tournament list using the cleaned tournament names and winners from the previous script\nlet tournamentList = \"\\n\\n\";\ntournaments.forEach((tournament) => {\n    let name = tournament.json?.name || \"Unknown Tournament\";\n    let winner = tournament.json?.winner || \"   No Winner\";\n    let entrants = tournament.json?.entrants || 0;\n    let location = tournament.json?.location? ` ${tournament.json?.location}` : \"\";\n\n    // Apply hashtagging to tournament names and winner names\n    name = addHashtags(name);\n    winner = addHashtags(winner);\n\n    tournamentList += `${name}${location} - ${entrants} entrants\\n${winner}\\n`;\n});\n\n// Construct the final message\nconst finalString = `${inputString}${tournamentList}\\n`;\n\n// Count the number of characters\nconst characterCount = finalString.length;\n\n// Return the result\nreturn [{ \n    result: finalString, \n    characterCount: characterCount \n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[848,560],"id":"1d4f88de-1f93-4bf6-93d3-8eb7a424dba5","name":"Code (Final Attempt)1"},{"parameters":{"jsCode":"// Define key phrases that should be kept and hashtagged\nconst hashtagKeywords = {\n};\n\n// Function to apply hashtags to specific keywords\nconst addHashtags = (name) => {\n    let updatedName = name;\n    Object.keys(hashtagKeywords).forEach((word) => {\n        const regex = new RegExp(`(?<!\\\\w)${word}(?!\\\\w)`, \"gi\");\n        updatedName = updatedName.replace(regex, hashtagKeywords[word]);\n    });\n    return updatedName;\n};\n\n// Retrieve total entrants\nconst totalEntrants = $('Edit Fields3').first().json.totalEntrants || 0;\n\n// Get tournament data from previous node\nconst tournaments = $input.all();\n\n// Ensure valid input\nif (!Array.isArray(tournaments) || tournaments.length === 0) {\n    return [{ result: \"Error: No tournament data received.\", characterCount: 0 }];\n}\n\n// Format the tournament list using the cleaned tournament names and winners from the previous script\nlet tournamentList = \"\";\ntournaments.forEach((tournament) => {\n    let name = tournament.json?.name || \"Unknown Tournament\";\n    let winner = tournament.json?.winner || \"   No Winner\";\n    let entrants = tournament.json?.entrants || 0;\n    let location = tournament.json?.location? ` ${tournament.json?.location}` : \"\";\n\n    // Apply hashtagging to tournament names and winner names\n    name = addHashtags(name);\n    winner = addHashtags(winner);\n\n    tournamentList += `${name}${location} - ${entrants} entrants\\n${winner}\\n`;\n});\n\n// Construct the final message\nconst finalString = `${tournamentList}`;\n\n// This line is a comment and won't affect the output\n// \\nEntrants yesterday: ${totalEntrants}`.trim();\n\n// Count the number of characters\nconst characterCount = finalString.length;\n\n// Return the result\nreturn [{ \n    result: finalString, \n    characterCount: characterCount \n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[848,800],"id":"b6c8325f-4e63-4cc5-a6c5-3d3325f9e02b","name":"Code (Final Attempt)2"},{"parameters":{"jsCode":"// Define key phrases that should be kept and hashtagged\nconst hashtagKeywords = {\n    \"Rivals2\": \"#Rivals2\",\n    \"Rivals of Aether\": \"#RivalsOfAether\",\n    \"Melee\": \"#Melee\",\n    \"Rivals\": \"#Rivals\",\n    \"Smash Ultimate\": \"#SmashUltimate\"\n};\n\n// Function to apply hashtags to specific keywords in a string,\n// but only if they are not already hashtagged.\nconst addHashtags = (name) => {\n    let updatedName = name;\n    Object.keys(hashtagKeywords).forEach((word) => {\n        // Only replace if not already preceded by a '#'\n        const regex = new RegExp(`(?<![#\\\\w])${word}(?!\\\\w)`, \"gi\");\n        updatedName = updatedName.replace(regex, hashtagKeywords[word]);\n    });\n    return updatedName;\n};\n\n// Function to clean winner names by removing sponsor prefixes\n//const cleanWinnerName = (winner) => {\n    //if (!winner) return \"\";\n    // Remove sponsor prefix if it exists (formatted as \"Sponsor | Winner\")\n    //return winner.includes(\"|\") ? winner.split(\"|\").pop().trim() : winner.trim();\n//};\n\n// Define mapping of character names to icons\nconst characterIcons = {\n    \"Forsburn\": \"â˜ ï¸\",\n    \"Loxodont\": \"ðŸ˜\",\n    \"Clairen\": \"ðŸ¤º\",\n    \"Zetterburn\": \"ðŸ¦\",\n    \"Wrastor\": \"ðŸ¦…\",\n    \"Fleet\": \"ðŸ¦Š\",\n    \"Maypul\": \"ðŸŒ±\",\n    \"Kragg\": \"ðŸª²\",\n    \"Ranno\": \"ðŸ¸\",\n    \"Orcane\": \"ðŸ‹\",\n    \"Etalus\": \"ðŸ»â€\",\n    \"Olympia\": \"ðŸ’Ž\"\n};\n\n// Retrieve tournament data\nconst tournamentData = Array.from({ length: 5 }, (_, i) => {\n    const tournamentNode = $('Aggregate').first().json.data[i]?.['data.data.tournaments.nodes'] || {};\n    const rawWinnerName = $('Aggregate').first().json.data[i]?.winnerName || \"\";\n\n    // Determine location: if countryCode exists and is not \"US\", use countryCode; otherwise, use addrState.\n    const location = (tournamentNode.countryCode && tournamentNode.countryCode !== \"US\")\n        ? tournamentNode.countryCode\n        : tournamentNode.addrState;\n  \n    // Retrieve the selections from the first game (if available) for character mapping\n    const selections = $('Aggregate').first().json.data[i]?.['data.data.set.games[0].selections'];\n    // Safely check for character name\n    const characterName = selections && selections.character ? selections.character.name : \"\";\n    // If a character name exists, use its mapped icon; otherwise, default to \"W:\"\n    const icon = characterName ? (characterIcons[characterName] || \"W:\") : \"W:\";\n\n    return {\n        name: tournamentNode.name || \"N/A\",\n        entrants: tournamentNode.events?.[0]?.numEntrants || 0,\n        winner: rawWinnerName ? `   ${icon} ${rawWinnerName}` : \"\",\n        location: location ? `(${location})` : \"\"\n    };\n});\n\n// Ensure the list is always 5 items long\nwhile (tournamentData.length < 5) {\n    tournamentData.push({ name: \"N/A\", entrants: 0, winner: \"\" });\n}\n\n// Return processed tournaments\nreturn tournamentData.slice(0, 5);\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[432,688],"id":"07eef46c-ed24-4786-b039-7a7b00387349","name":"Code (Truncate Sponsors)1"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1264,672],"id":"774b4109-f79c-4229-84f2-abe12f222987","name":"Aggregate2"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[1072,672],"id":"01c74cea-ead5-4647-9e82-d93f4c18159b","name":"Merge2"},{"parameters":{"operation":"roundDate","date":"={{ $json.currentDate }}","toNearest":"day","options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-4704,880],"id":"e8322ebf-4443-4c84-a91a-0603121b0e46","name":"Date & Time4"},{"parameters":{"postText":"={{ $json.result }}"},"type":"@muench-dev/n8n-nodes-bluesky.bluesky","typeVersion":2,"position":[288,304],"id":"ec68d457-015f-41db-a0e8-9ece39ef4c30","name":"Bluesky","credentials":{"blueskyApi":{"id":"QPGGEIIpgB13gOeW","name":"Bluesky account"}}},{"parameters":{"operation":"addToDate","magnitude":"={{ $json.roundedDate }}","timeUnit":"hours","duration":5,"options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-4480,800],"id":"4785443c-e8fc-448c-9e35-786a5d7418b6","name":"Date & Time5"}],"connections":{"Date & Time1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Date & Time":{"main":[[{"node":"Date & Time4","type":"main","index":0}]]},"Date & Time2":{"main":[[{"node":"Date & Time3","type":"main","index":0}]]},"Date & Time3":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"GraphQL Events","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Split Out4","type":"main","index":0},{"node":"Merge Events1","type":"main","index":0}]]},"Filter1":{"main":[[{"node":"Summarize","type":"main","index":0},{"node":"Sort","type":"main","index":0}]]},"Summarize":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"Limit":{"main":[[{"node":"GraphQL Phases","type":"main","index":0},{"node":"Merge Events","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Assemble Post","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Run Daily @ 4:21pm":{"main":[[{"node":"Date & Time","type":"main","index":0}]]},"GraphQL Events":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"GraphQL Phases":{"main":[[{"node":"Split Out1","type":"main","index":0}]]},"Split Out1":{"main":[[{"node":"Sort1","type":"main","index":0}]]},"Sort1":{"main":[[{"node":"Code3","type":"main","index":0}]]},"Split Out2":{"main":[[{"node":"Sort2","type":"main","index":0}]]},"Sort2":{"main":[[{"node":"Code Top5 Events","type":"main","index":0}]]},"GraphQL Phases1":{"main":[[{"node":"Split Out2","type":"main","index":0}]]},"GraphQL Phases2":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Merge Winners1","type":"main","index":0}]]},"Filter":{"main":[[{"node":"GraphQL Phases2","type":"main","index":0},{"node":"GraphQL Phases3","type":"main","index":0}]]},"Merge Events":{"main":[[{"node":"Merge Events and Winners","type":"main","index":0}]]},"Merge Events and Winners":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Merge Winners":{"main":[[{"node":"Merge Events and Winners","type":"main","index":1}]]},"Code Top5 Events":{"main":[[{"node":"Filter","type":"main","index":0},{"node":"Merge Events","type":"main","index":1},{"node":"Merge Winners","type":"main","index":0}]]},"If 280 > x > 300":{"main":[[{"node":"Bluesky","type":"main","index":0}],[{"node":"Code (Truncate Sponsors)1","type":"main","index":0}]]},"Assemble Post":{"main":[[{"node":"Edit Fields3","type":"main","index":0}]]},"GraphQL Phases3":{"main":[[{"node":"Split Out3","type":"main","index":0}]]},"Merge Winners1":{"main":[[{"node":"Merge Winners","type":"main","index":1}]]},"Split Out3":{"main":[[{"node":"Filter2","type":"main","index":0}]]},"Filter2":{"main":[[{"node":"Merge Winners1","type":"main","index":1}]]},"Split Out4":{"main":[[{"node":"Merge Events1","type":"main","index":1}]]},"Merge Events1":{"main":[[{"node":"Filter1","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Code3":{"main":[[{"node":"GraphQL Phases1","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"If 280 > x > 300","type":"main","index":0}]]},"Sort":{"main":[[{"node":"Limit","type":"main","index":0}]]},"Create Bluesky Session":{"main":[[{"node":"Create Post Text","type":"main","index":0}]]},"Set Bluesky Credentials":{"main":[[{"node":"Create Bluesky Session","type":"main","index":0}]]},"Create Initial Post":{"main":[[{"node":"Create Reply Text1","type":"main","index":0}]]},"Create Post Text":{"main":[[{"node":"Create Initial Post","type":"main","index":0}]]},"Create Reply Text1":{"main":[[{"node":"Create Reply1","type":"main","index":0}]]},"Limit1":{"main":[[{"node":"Code (Final Attempt)1","type":"main","index":0}]]},"Limit2":{"main":[[{"node":"Code (Final Attempt)2","type":"main","index":0}]]},"Code (Final Attempt)1":{"main":[[{"node":"Merge2","type":"main","index":0}]]},"Code (Final Attempt)2":{"main":[[{"node":"Merge2","type":"main","index":1}]]},"Code (Truncate Sponsors)1":{"main":[[{"node":"Limit1","type":"main","index":0},{"node":"Limit2","type":"main","index":0}]]},"Aggregate2":{"main":[[{"node":"Set Bluesky Credentials","type":"main","index":0}]]},"Merge2":{"main":[[{"node":"Aggregate2","type":"main","index":0}]]},"Date & Time4":{"main":[[{"node":"Date & Time2","type":"main","index":0},{"node":"Date & Time5","type":"main","index":0}]]},"Date & Time5":{"main":[[{"node":"Date & Time1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":{"node:Run Daily @ 4:21pm":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"7d26af9e-e07f-4a38-a109-db073b1267d3","activeVersionId":null,"triggerCount":1,"shared":[{"updatedAt":"2026-02-06T21:50:23.828Z","createdAt":"2026-02-06T21:50:23.828Z","role":"workflow:owner","workflowId":"n7uv54FsKN6pUjFy","projectId":"u9kYCfFU7pgjjx9U"}],"activeVersion":null,"tags":[{"updatedAt":"2025-10-19T02:01:25.366Z","createdAt":"2025-10-19T02:01:25.366Z","id":"WjYjrAQMMnwIYj0J","name":"Active"}]}